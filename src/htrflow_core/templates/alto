<?xml version="1.0" encoding="UTF-8"?>
<alto xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.loc.gov/standards/alto/ns-v4#" xsi:schemaLocation="http://www.loc.gov/standards/alto/ns-v4# http://www.loc.gov/standards/alto/v4/alto-4-4.xsd">
    <Description>
        <MeasurementUnit>pixel</MeasurementUnit>
        <sourceImageInformation>
            <fileName>{{ page.image_path }}</fileName>
        </sourceImageInformation>
        {%- for step in metadata.processing_steps %}
        <Processing ID="step{{ loop.index }}">
            <processingDateTime>{{ metadata.created }}</processingDateTime>
            <processingStepDescription>{{ step.description}} </processingStepDescription>
            <processingStepSettings>{{ step.settings }}</processingStepSettings>
            <processingSoftware>
                <softwareCreator>{{ metadata.creator }}</softwareCreator>
                <softwareName>{{ metadata.software_name }}</softwareName>
                <softwareVersion>{{ metadata.software_version }}</softwareVersion>
                <applicationDescription>{{ metadata.application_description }}</applicationDescription>
            </processingSoftware>
        </Processing>
        {%- endfor %}
    </Description>
    <ReadingOrder>
        {%- for block in blocks recursive %}
        {%- if block.text %}
            <ElementRef ID="reading_order_{{ labels[block] }}" REF="{{ labels[block] }}" />
        {%- else %}
        <OrderedGroup ID="reading_order_{{ labels[block] }}">{{ loop(block.children) }}
        </OrderedGroup>
        {%- endif %}
        {%- endfor %}
    </ReadingOrder>
    <Layout>
        <Page WIDTH="{{ page.width }}" HEIGHT="{{ page.height }}" PHYSICAL_IMG_NR="0" ID="PAGE">
            <TopMargin />
            <LeftMargin />
            <RightMargin />
            <BottomMargin />
            <PrintSpace>
                {%- for block in blocks %}
                <TextBlock ID="{{ labels[block] }}" HPOS="{{ block.x }}" VPOS="{{ block.y }}" HEIGHT="{{ block.height}}" WIDTH="{{ block.width }}">
                    {%- if block.polygon %}
                    <Shape>
                        <Polygon POINTS="{% for point in block.polygon %}{{ point|join(',') }}{% if not loop.last %} {% endif %}{% endfor %}"/>
                    </Shape>
                    {%- endif %}
                    {%- for line in block.children %}
                    <TextLine ID="{{ labels[line] }}"  HPOS="{{ line.x }}" VPOS="{{ line.y }}" HEIGHT="{{ line.height}}" WIDTH="{{ line.width }}">
                        <String CONTENT="{{line.text.top_candidate()}}" />
                    </TextLine>
                    {%- endfor %}
                </TextBlock>
                {%- endfor %}
            </PrintSpace>
        </Page>
    </Layout>
</alto>
